;----------------------------------------------------------------
; 事件管理器 这个事件是广义上的一切事件
;----------------------------------------------------------------
@Event_Manager()

    CurrentEventID = -1
    REPEAT VARSIZE(EventName)
        IF EventName:COUNT != ""
            CONTINUE
        ELSE
            CurrentEventID = COUNT
            CALL Notification_Listener(EventName:COUNT)
        ENDIF
    REND


@Notification_Listener(eventName)
    #DIMS eventName

    REPEAT VARSIZE(EventListenerEnum)
        IF EventListenerEnum:COUNT != eventName
            CONTINUE
        ELSE
            TRYCALLFORM {EventListenerFunction:COUNT}({EventObj:CurrentEventID})
            RETURN
        ENDIF
    REND
    RETURN



@Listen_Event(event_enum, callBackFunctionName)
    #DIMS event_enum
    #DIMS callBackFunctionName

    REPEAT VARSIZE(EventListenerEnum)
        IF EventListenerEnum:COUNT != ""
            CONTINUE
        ELSE
            EventListenerEnum:COUNT = event_enum
            EventListenerFunction:COUNT = callBackFunctionName
            RETURN
        ENDIF
    REND
    ErrorInfo = "监听队列已满，扩容吧！"
    RETURN


@Unlisten_Event(event_enum, callBackFunctionName)
    #DIMS event_enum
    #DIMS callBackFunctionName
    #DIM index

    index = FINDELEMENT(EventListenerEnum, event_enum, , , 1)
    IF index == -1
        ErrorInfo = "找不到需要移除的监听"
        RETURN
    ENDIF
    EventListenerEnum:index =
    EventListenerFunction =
    RETURN


@Trigger_Event(event_enum, eventObj)
    #DIMS event_enum
    #DIMS eventObj

    REPEAT VARSIZE(EventName)
        IF EventName:COUNT != ""
            CONTINUE
        ELSE
            EventName:COUNT = event_enum
            EventObj:COUNT = eventObj
            RETURN
        ENDIF
    REND
    ErrorInfo = "事件队列已满，扩容吧！"
    RETURN

